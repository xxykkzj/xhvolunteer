# 寺院志愿者系统 - 业务配置文档

## 文档说明

本文档记录系统中所有需要配置的业务规则和数据。标记为 ✅ 的项目已在系统中配置，标记为 ⚠️ 的项目需要寺院方面补充确认。

---

## 一、部门配置

### 当前已配置部门 ✅

根据数据库查询，系统中已有以下部门（具体名称需查看数据库实际内容）：

| 部门ID | 部门名称 | 上级中心 | 创建时间 |
|--------|----------|----------|----------|
| 1 | （待查询） | - | - |
| 2 | （待查询） | - | - |
| 3 | （待查询） | - | - |

### 需要补充的部门信息 ⚠️

请提供完整的部门列表，包括：

1. **部门名称**（中文）
2. **部门描述**（简短说明部门职责）
3. **是否有上级中心**（如果有层级结构）
4. **工时积分转换率**（见下方"工时积分配置"）

**示例格式**：
```
- 藏经阁（图书馆）
  - 描述：负责经书整理、借阅管理、阅览室维护
  - 上级中心：文化中心
  - 工时积分率：1小时 = 10积分

- 客堂（接待处）
  - 描述：负责访客接待、咨询服务、活动报名
  - 上级中心：行政中心
  - 工时积分率：1小时 = 10积分

- 斋堂（餐厅）
  - 描述：负责餐食准备、用餐服务、厨房清洁
  - 上级中心：生活服务中心
  - 工时积分率：1小时 = 12积分（体力劳动加成）
```

---

## 二、会员等级体系

### 当前配置 ✅

系统采用**十地菩萨前七地**作为会员等级体系：

| 等级 | 名称 | 英文名 | 所需积分范围 | 说明 |
|------|------|--------|--------------|------|
| 1 | 欢喜地 | Joyful Ground | 0 - 99 | 初始等级，刚注册的志愿者 |
| 2 | 离垢地 | Stainless Ground | 100 - 199 | 完成基础服务，开始积累经验 |
| 3 | 发光地 | Luminous Ground | 200 - 999 | 持续参与，展现奉献精神 |
| 4 | 焰慧地 | Radiant Ground | 1000 - 1999 | 资深志愿者，经验丰富 |
| 5 | 难胜地 | Invincible Ground | 2000 - 5999 | 核心志愿者，贡献卓越 |
| 6 | 现前地 | Manifest Ground | 6000 - 9999 | 长期奉献，德行显著 |
| 7 | 远行地 | Far-Reaching Ground | 10000+ | 最高等级，菩萨行者 |

**等级计算规则**：
- 基于**累计积分**自动升级
- 积分不会因兑换奖励而降级（等级快照独立计算）
- 等级提升后不可降级

### 需要确认 ⚠️

1. **等级积分阈值是否合理？**
   - 当前设定：100/200/1000/2000/6000/10000
   - 是否需要调整？（例如降低门槛以鼓励志愿者）

2. **等级是否有特殊权益？**
   - 当前：仅用于奖励兑换资格判断
   - 是否需要：优先报名活动、专属课程、特殊徽章等？

---

## 三、欢喜徽记（Joy Badge）

### 当前配置 ✅

**获得条件**：累计服务满 **70小时** 自动授予

**作用**：
- 部分高级奖励需要欢喜徽记才能兑换
- 象征志愿者的长期奉献精神

### 需要确认 ⚠️

1. **70小时门槛是否合适？**
   - 是否需要调整为50小时、100小时或其他值？

2. **是否需要多级徽记？**
   - 例如：铜徽记（70小时）、银徽记（200小时）、金徽记（500小时）

3. **徽记是否有其他用途？**
   - 当前仅用于兑换资格
   - 是否需要：活动优先权、积分加成、特殊称号等？

---

## 四、工时积分配置

### 当前配置 ✅

**统一转换率**：**1小时 = 10积分**

**计算方式**：
- 考勤确认时自动记录实际工时（以分钟为单位存储）
- 自动转换为积分并记入积分账本
- 同时更新累计工时和累计积分

**示例**：
- 服务2小时 → 获得20积分
- 服务3.5小时 → 获得35积分

### 需要配置 ⚠️

**不同部门的工时积分率**（如果需要差异化）：

| 部门类型 | 建议积分率 | 理由 |
|----------|------------|------|
| 体力劳动型（斋堂、清洁） | 1小时 = 12-15积分 | 体力消耗大，给予加成 |
| 技能型（图书馆、文案） | 1小时 = 10积分 | 标准积分率 |
| 管理型（客堂、组织） | 1小时 = 10积分 | 标准积分率 |
| 特殊活动（法会、大型活动） | 1小时 = 15-20积分 | 临时性、强度大 |

**请提供**：
1. 每个部门的具体积分率
2. 是否有季节性调整（例如夏季户外工作加成）
3. 是否有节假日加成（例如春节期间服务双倍积分）

---

## 五、奖励商城配置

### 当前已配置奖励 ✅

系统中已有 **9个奖励**，按积分成本排序：

| 奖励名称 | 积分成本 | 最低等级要求 | 需要欢喜徽记 | 库存 | 状态 |
|----------|----------|--------------|--------------|------|------|
| （待查询具体数据） | - | - | - | - | - |

**已知示例奖励**（根据之前开发记录）：
- 寺院住宿一晚：25积分，等级1，无需徽记
- 一日禅修课程：40积分，等级1，无需徽记
- 寺院参观券：50积分，等级1，无需徽记
- 经缘书籍：100积分，等级1，无需徽记
- 三日禅修课程：100积分，等级1，无需徽记
- 禅茶体验：200积分，等级2，无需徽记

### 需要补充的奖励信息 ⚠️

请提供完整的奖励目录，包括：

1. **奖励名称**（中文）
2. **详细描述**（包括使用说明、有效期等）
3. **积分成本**
4. **最低等级要求**（1-7）
5. **是否需要欢喜徽记**
6. **库存数量**（-1表示无限量）
7. **奖励图片**（可选，用于商城展示）

**建议奖励类别**：

#### A. 课程类（学习体验）
```
- 一日禅修课程：40积分，等级1
- 三日禅修课程：100积分，等级1
- 七日禅修营：250积分，等级2，需要欢喜徽记
- 佛学讲座门票：20积分，等级1
- 抄经体验课：30积分，等级1
- 茶道禅修课：50积分，等级1
```

#### B. 住宿类（寺院体验）
```
- 寺院住宿一晚：25积分，等级1
- 寺院住宿三晚：60积分，等级1
- 寺院住宿一周：140积分，等级2
- 禅房体验（单人）：80积分，等级2
```

#### C. 物品类（结缘品）
```
- 经缘书籍：100积分，等级1
- 佛珠手串：150积分，等级2
- 禅修坐垫：200积分，等级2
- 书法作品：500积分，等级3，需要欢喜徽记
- 定制法名牌：300积分，等级3
```

#### D. 服务类（特殊体验）
```
- 禅茶体验：200积分，等级2
- 素食烹饪课：120积分，等级2
- 园艺禅修：80积分，等级1
- 寺院导览服务：免费（仅需等级1）
- 一对一禅修指导：400积分，等级3，需要欢喜徽记
```

#### E. 高级奖励（长期志愿者专属）
```
- 年度禅修营（7天）：1000积分，等级4，需要欢喜徽记
- 寺院文化游学（含食宿）：1500积分，等级5，需要欢喜徽记
- 定制禅修计划：2000积分，等级5，需要欢喜徽记
- 寺院荣誉志愿者证书：3000积分，等级6，需要欢喜徽记
```

---

## 六、积分获取渠道

### 当前已实现 ✅

1. **考勤积分**：完成排班服务后，根据实际工时自动获得积分
2. **部门奖励积分**：部门负责人可申请奖励积分给表现优秀的志愿者（需经理/管理员审批）

### 需要确认的积分规则 ⚠️

1. **新用户注册奖励**
   - 是否给予注册奖励积分？（例如：注册即送10积分）
   - 目的：鼓励新志愿者加入

2. **推荐奖励**
   - 是否设置推荐新志愿者的奖励？（例如：推荐1人注册并完成首次服务，奖励20积分）

3. **连续服务奖励**
   - 是否设置连续签到奖励？（例如：连续服务7天，额外奖励50积分）

4. **特殊贡献奖励**
   - 是否设置特殊贡献的一次性奖励？（例如：组织大型活动、培训新志愿者等）

5. **积分过期政策**
   - 积分是否有有效期？（当前：永久有效）
   - 是否需要设置：例如"积分自获得之日起2年内有效"？

---

## 七、部门月度奖励配额

### 当前配置 ✅

**机制说明**：
- 每个部门每月有固定的奖励积分配额
- 部门负责人可为表现优秀的志愿者申请奖励积分
- 需要经理/管理员审批
- 配额用完后当月无法再申请

**当前配额**（需要在数据库中配置）：
- 未设置默认值，需要管理员为每个部门每月手动配置

### 需要配置 ⚠️

**各部门月度奖励配额建议**：

| 部门规模 | 志愿者人数 | 建议月度配额 | 说明 |
|----------|------------|--------------|------|
| 小型部门 | 5-10人 | 100-200积分 | 每人平均可获10-20积分 |
| 中型部门 | 11-30人 | 300-500积分 | 奖励表现突出的20-30%志愿者 |
| 大型部门 | 31人以上 | 600-1000积分 | 灵活分配，鼓励竞争 |

**请提供**：
1. 每个部门的具体月度配额
2. 配额是否可跨月累积？（例如：本月未用完的配额是否可结转到下月）
3. 配额审批流程：
   - 部门负责人申请 → 经理审批？
   - 还是：部门负责人申请 → 经理审批 → 管理员最终审批？

---

## 八、用户角色与权限

### 当前配置 ✅

系统支持 **5级角色体系**：

| 角色 | 英文名 | 权限范围 |
|------|--------|----------|
| 志愿者 | volunteer | 查看自己的信息、兑换奖励、查看排班 |
| 组长 | leader | 志愿者权限 + 确认考勤、验证兑换码 |
| 经理 | manager | 组长权限 + 创建排班、管理部门、审批奖励积分 |
| 管理员 | admin | 经理权限 + 管理用户角色、配置系统、查看审计日志 |
| 超级管理员 | super-admin | 所有权限（预留，暂未使用） |

### 需要确认 ⚠️

1. **角色分配原则**
   - 谁负责分配角色？（当前：管理员）
   - 是否需要申请流程？（例如：志愿者服务满100小时可申请成为组长）

2. **部门负责人**
   - 部门负责人是否自动获得"经理"角色？
   - 还是部门负责人只是"组长"角色，经理是跨部门的管理层？

3. **权限细化**
   - 是否需要更细粒度的权限？（例如：只能管理自己部门的排班，不能管理其他部门）

---

## 九、排班与考勤规则

### 当前配置 ✅

**排班规则**：
- 经理/管理员创建排班（指定日期、部门、班次时间、所需人数）
- 组长/经理分配志愿者到排班
- 支持日历视图查看排班

**考勤规则**：
- 组长/经理在服务结束后确认考勤
- 记录实际工时（可与计划工时不同）
- 自动计算积分并记入账本
- 自动更新志愿者的累计工时和等级

### 需要补充的规则 ⚠️

1. **排班提前期**
   - 排班需要提前多少天发布？（例如：至少提前3天）

2. **志愿者报名机制**
   - 当前：由组长/经理指定分配
   - 是否需要：志愿者自主报名，组长审核？

3. **缺勤处理**
   - 志愿者临时无法参加如何处理？
   - 是否需要请假流程？
   - 是否有缺勤惩罚？（例如：无故缺勤扣除积分）

4. **迟到/早退**
   - 是否需要记录迟到/早退？
   - 是否影响积分计算？（例如：迟到30分钟，按实际工时计算积分）

5. **加班/超时**
   - 超过计划工时的服务是否有加成？（例如：超时部分按1.5倍积分计算）

---

## 十、寺院工作人员（temple_worker）配置

### 当前数据库设计 ✅

系统支持两类服务关系（engagements表）：
1. **volunteer_shortterm**：短期义工（纯志愿者，积分制）
2. **temple_worker**：寺院工作人员

**temple_worker字段**：
- `hourlyRate`：时薪（以分为单位存储，例如5000表示50.00元/小时）
- `salaryScheme`：薪资方案（hourly=按小时，fixed=固定月薪，none=无薪资）
- `fixedMonthly`：固定月薪（以分为单位存储）
- `allowPointsOnPaidHours`：有薪工时是否也获得积分（布尔值）

### 需要明确的业务逻辑 ⚠️

根据您的说明"寺院其实没有真正意义上的payroll，更多是各个部门工时对应的奖励积分"，请确认：

1. **寺院工作人员是否也是积分制？**
   - 选项A：寺院工作人员也是纯积分制，只是工时积分率可能不同（例如1小时=15积分）
   - 选项B：寺院工作人员有实际薪资，但同时也可以获得积分
   - 选项C：寺院工作人员纯粹是薪资制，不参与积分系统

2. **如果是积分制（选项A）**：
   - 寺院工作人员的工时积分率是多少？
   - 是否与志愿者使用相同的等级体系和奖励商城？
   - 是否需要区分"全职工作人员"和"兼职工作人员"？

3. **如果是混合制（选项B）**：
   - 有薪工时是否也获得积分？（allowPointsOnPaidHours字段）
   - 积分率是否与无薪志愿者相同？

4. **如果是纯薪资制（选项C）**：
   - 是否需要保留payroll相关功能？
   - 还是完全移除，只保留志愿者积分系统？

**建议**：
根据寺院实际情况，我倾向于**选项A（纯积分制）**，理由：
- 符合寺院"奉献"而非"雇佣"的理念
- 简化系统，避免涉及劳动法、税务等复杂问题
- 统一管理，所有人都使用积分系统

如果采用选项A，Phase 9应该改为：
- **Phase 9: 工时积分配置与统计报表**
  - 配置不同部门/岗位的工时积分率
  - 生成志愿者服务统计报表
  - 生成部门工时统计报表
  - 导出数据用于寺院内部管理

---

## 十一、数据导出需求

### 需要确认 ⚠️

系统需要导出哪些报表？

1. **志愿者报表**
   - 志愿者服务时长统计（按月/季度/年）
   - 志愿者积分获取明细
   - 志愿者等级分布统计
   - 欢喜徽记获得者名单

2. **部门报表**
   - 部门服务时长统计
   - 部门志愿者活跃度排名
   - 部门奖励积分使用情况

3. **奖励报表**
   - 奖励兑换统计（按奖励类型）
   - 奖励库存预警
   - 兑换码使用情况

4. **导出格式**
   - Excel (.xlsx)
   - CSV
   - PDF报表

---

## 十二、系统通知与提醒

### 需要确认 ⚠️

系统是否需要以下通知功能？

1. **志愿者通知**
   - 排班提醒（服务前1天提醒）
   - 等级提升通知
   - 欢喜徽记获得通知
   - 积分到账通知
   - 兑换成功通知

2. **管理员通知**
   - 奖励积分申请待审批
   - 奖励库存不足预警
   - 新志愿者注册通知

3. **通知渠道**
   - 系统内通知（站内信）
   - 微信通知（需要微信服务号）
   - 短信通知（成本较高）
   - 邮件通知

---

## 十三、下一步行动

### 请您提供以下信息：

1. ✅ **确认寺院工作人员是否也是积分制**（见第十节）
2. ⚠️ **完整的部门列表及工时积分率**（见第一节、第四节）
3. ⚠️ **完整的奖励目录**（见第五节）
4. ⚠️ **确认等级积分阈值和欢喜徽记门槛**（见第二节、第三节）
5. ⚠️ **部门月度奖励配额**（见第七节）
6. ⚠️ **其他业务规则确认**（见第六、八、九、十一、十二节）

### 我将根据您的反馈：

1. 更新TODO.md，将Phase 9调整为"工时积分配置与统计报表"（如果确认是纯积分制）
2. 创建数据导入脚本，批量添加部门和奖励
3. 继续开发下一阶段功能

---

**文档版本**：v1.0  
**创建日期**：2025-01-01  
**最后更新**：2025-01-01  
**维护者**：开发团队
